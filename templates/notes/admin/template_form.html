{% extends "base.html" %}
{% load i18n %}

{% block title %}{% if editing %}{% trans "Edit" %}{% else %}{% trans "New" %}{% endif %} {{ term.progress_note|default:"Note" }} {% trans "Template" %}{% endblock %}

{% block content %}
<hgroup>
    <h1>{% if editing %}{% blocktrans with note=term.progress_note|default:"Note" %}Edit {{ note }} Template{% endblocktrans %}{% else %}{% blocktrans with note=term.progress_note|default:"Note" %}New {{ note }} Template{% endblocktrans %}{% endif %}</h1>
</hgroup>

<form method="post">
    {% csrf_token %}

    <fieldset>
        <legend>{% trans "Template Details" %}</legend>
        {% for field in form %}
        <label for="{{ field.id_for_label }}">{{ field.label }}</label>
        {{ field }}
        {% if field.errors %}<small class="error" role="alert">{{ field.errors.0 }}</small>{% endif %}
        {% endfor %}
    </fieldset>

    <fieldset>
        <legend>{% trans "Sections" %}</legend>
        {{ formset.management_form }}
        {% for section_form in formset %}
        <article>
            {% if section_form.instance.pk %}
            <header>{% blocktrans with num=forloop.counter %}Section {{ num }}{% endblocktrans %}</header>
            {% else %}
            <header>{% trans "New Section" %}</header>
            {% endif %}
            {{ section_form.id }}
            {% for field in section_form %}
                {% if field.name != "id" and field.name != "DELETE" %}
                <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                {{ field }}
                {% if field.errors %}<small class="error" role="alert">{{ field.errors.0 }}</small>{% endif %}
                {% endif %}
            {% endfor %}
            {% if section_form.instance.pk %}
            <label>
                {{ section_form.DELETE }} {% trans "Remove this section" %}
            </label>
            {% endif %}
        </article>
        {% endfor %}
    </fieldset>

    <div role="group">
        <button type="submit">{% trans "Save Template" %}</button>
        <a href="{% url 'note_templates:template_list' %}" role="button" class="outline secondary">{% trans "Cancel" %}</a>
    </div>
</form>
{% endblock %}
