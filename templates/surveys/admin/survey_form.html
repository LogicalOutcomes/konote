{% extends "base.html" %}
{% load i18n %}

{% block title %}{% if editing %}{% trans "Edit Survey" %}{% else %}{% trans "New Survey" %}{% endif %}{% endblock %}

{% block content %}
<hgroup>
    <h1>{% if editing %}{% trans "Edit Survey" %}{% else %}{% trans "New Survey" %}{% endif %}</h1>
    <p>{% trans "Set up the survey name, description, and sections." %}</p>
</hgroup>

<form method="post">
    {% csrf_token %}

    <fieldset>
        <legend>{% trans "Survey Details" %}</legend>
        {% for field in form %}
        <label for="{{ field.id_for_label }}">{{ field.label }}{% if field.field.required %} <abbr title="{% trans 'required' %}">*</abbr>{% endif %}</label>
        {{ field }}
        {% if field.help_text %}<small>{{ field.help_text }}</small>{% endif %}
        {% if field.errors %}<small class="error" role="alert">{{ field.errors.0 }}</small>{% endif %}
        {% endfor %}
    </fieldset>

    <fieldset>
        <legend>{% trans "Sections" %}</legend>
        <p><small>{% trans "Every survey needs at least one section. Sections group questions together." %}</small></p>
        {{ formset.management_form }}
        {% for section_form in formset %}
        <article>
            {% if section_form.instance.pk %}
            <header>{% blocktrans with num=forloop.counter %}Section {{ num }}{% endblocktrans %}</header>
            {% else %}
            <header>{% trans "New Section" %}</header>
            {% endif %}
            {{ section_form.id }}
            {% for field in section_form %}
                {% if field.name != "id" and field.name != "DELETE" %}
                <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                {{ field }}
                {% if field.help_text %}<small>{{ field.help_text }}</small>{% endif %}
                {% if field.errors %}<small class="error" role="alert">{{ field.errors.0 }}</small>{% endif %}
                {% endif %}
            {% endfor %}
            {% if section_form.instance.pk %}
            <label>
                {{ section_form.DELETE }} {% trans "Remove this section" %}
            </label>
            {% endif %}
        </article>
        {% endfor %}
    </fieldset>

    <div role="group">
        <button type="submit">{% if editing %}{% trans "Save Changes" %}{% else %}{% trans "Create Survey" %}{% endif %}</button>
        <a href="{% url 'survey_manage:survey_list' %}" role="button" class="outline secondary">{% trans "Cancel" %}</a>
    </div>
</form>
{% endblock %}
