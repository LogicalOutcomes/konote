{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "Settings" %} — {{ site.product_name|default:"KoNote" }}{% endblock %}

{% block content %}
<div class="page-header">
    <h1>{% trans "Settings" %}</h1>
    <p>{% trans "Manage your instance configuration." %}</p>
</div>

<div class="settings-grid">
    <article>
        <header>{% trans "Terminology" %}</header>
        <p>{% trans 'Customise the words used throughout the system (e.g. rename "Participant" to "Client").' %}</p>
        <p class="settings-indicator">
            {% if terminology_overrides %}
                {% blocktrans count count=terminology_overrides %}{{ count }} term customised{% plural %}{{ count }} terms customised{% endblocktrans %}
            {% else %}
                {% trans "Using defaults" %}
            {% endif %}
        </p>
        <footer><a href="{% url 'admin_settings:terminology' %}" role="button" class="outline">{% trans "Manage Terminology" %}</a></footer>
    </article>

    <article>
        <header>{% trans "Features" %}</header>
        <p>{% trans "Turn modules on or off for your organisation." %}</p>
        <p class="settings-indicator">{% blocktrans with enabled=enabled_features total=total_features %}{{ enabled }} of {{ total }} enabled{% endblocktrans %}</p>
        <footer><a href="{% url 'admin_settings:features' %}" role="button" class="outline">{% trans "Manage Features" %}</a></footer>
    </article>

    <article>
        <header>{% trans "Instance Settings" %}</header>
        <p>{% trans "Branding, date format, and session timeout." %}</p>
        <p class="settings-indicator">
            {% if instance_settings_count %}
                {% blocktrans count count=instance_settings_count %}{{ count }} setting customised{% plural %}{{ count }} settings customised{% endblocktrans %}
            {% else %}
                {% trans "Using defaults" %}
            {% endif %}
        </p>
        <footer><a href="{% url 'admin_settings:instance_settings' %}" role="button" class="outline">{% trans "Manage Settings" %}</a></footer>
    </article>

    {% if access_tier >= 2 %}
    <article>
        <header>{% trans "Field Access for Front Desk" %}</header>
        <p>{% trans "Configure which fields front desk staff can see or edit on participant records." %}</p>
        <p class="settings-indicator">
            {% if field_access_count %}
                {% blocktrans count count=field_access_count %}{{ count }} field accessible{% plural %}{{ count }} fields accessible{% endblocktrans %}
            {% else %}
                {% trans "No fields accessible" %}
            {% endif %}
        </p>
        <footer><a href="{% url 'admin_settings:field_access' %}" role="button" class="outline">{% trans "Manage Field Access" %}</a></footer>
    </article>
    {% endif %}

    {% if access_tier >= 3 %}
    <article>
        <header>{% trans "Clinical Access Grants" %}</header>
        <p>{% trans "View and monitor all documented justifications for program manager access to clinical data." %}</p>
        <p class="settings-indicator">
            {% if active_grant_count %}
                {% blocktrans count count=active_grant_count %}{{ count }} active grant{% plural %}{{ count }} active grants{% endblocktrans %}
            {% else %}
                {% trans "No active grants" %}
            {% endif %}
        </p>
        <footer><a href="{% url 'admin_settings:access_grant_admin_list' %}" role="button" class="outline">{% trans "View Grants" %}</a></footer>
    </article>

    <article>
        <header>{% trans "Access Grant Reasons" %}</header>
        <p>{% trans "Manage the list of reasons program managers can choose when requesting clinical access." %}</p>
        <p class="settings-indicator">
            {% blocktrans count count=active_reason_count %}{{ count }} active reason{% plural %}{{ count }} active reasons{% endblocktrans %}
        </p>
        <footer><a href="{% url 'admin_settings:access_grant_reasons' %}" role="button" class="outline">{% trans "Manage Reasons" %}</a></footer>
    </article>
    {% endif %}

    <article>
        <header>{% trans "Users" %}</header>
        <p>{% trans "Create, edit, and deactivate user accounts." %}</p>
        <p class="settings-indicator">{% blocktrans count count=active_users %}{{ count }} active user{% plural %}{{ count }} active users{% endblocktrans %}</p>
        <footer><a href="{% url 'admin_users:user_list' %}" role="button" class="outline">{% trans "Manage Users" %}</a></footer>
    </article>

    <article>
        <header>{% trans "Note Templates" %}</header>
        <p>{% trans "Define structures for progress notes (e.g. Standard session, Crisis intervention)." %}</p>
        <p class="settings-indicator">{% blocktrans count count=note_template_count %}{{ count }} template{% plural %}{{ count }} templates{% endblocktrans %}</p>
        <footer><a href="{% url 'note_templates:template_list' %}" role="button" class="outline">{% trans "Manage Templates" %}</a></footer>
    </article>

    <article>
        <header>{% trans "Demo Accounts" %}</header>
        <p>{% trans "View all demo users and demo participants. Impersonate demo users for testing." %}</p>
        <p class="settings-indicator">
            {% if demo_users %}
                {% blocktrans count count=demo_users %}{{ count }} demo user{% plural %}{{ count }} demo users{% endblocktrans %}
            {% else %}
                {% trans "No demo accounts" %}
            {% endif %}
        </p>
        <footer>
            <a href="{% url 'admin_settings:demo_directory' %}" role="button" class="outline">{% trans "Demo Directory" %}</a>
            <a href="{% url 'admin_settings:demo_data_management' %}" role="button" class="outline" style="margin-left: 0.5rem;">{% trans "Demo Data" %}</a>
        </footer>
    </article>

    <article>
        <header>{% trans "Messaging" %}</header>
        <p>{% trans "Configure appointment reminders, message templates, and channel settings." %}</p>
        <p class="settings-indicator">
            {% if messaging_profile == "record_keeping" %}
                {% trans "Record-keeping only" %}
            {% elif messaging_profile == "staff_sent" %}
                {% trans "Staff-sent messages enabled" %}
            {% elif messaging_profile == "full_automation" %}
                {% trans "Full automation enabled" %}
            {% endif %}
        </p>
        <footer><a href="{% url 'admin_settings:messaging_settings' %}" role="button" class="outline">{% trans "Messaging Settings" %}</a></footer>
    </article>

    <article>
        <header>{% trans "Partners & Reports" %}</header>
        <p>{% trans "Manage reporting partners (funders, networks, boards) and their report templates." %}</p>
        <p class="settings-indicator">
            {% if partner_count %}
                {% blocktrans count count=partner_count %}{{ count }} partner{% plural %}{{ count }} partners{% endblocktrans %}
                · {% blocktrans count count=report_template_count %}{{ count }} template{% plural %}{{ count }} templates{% endblocktrans %}
            {% else %}
                {% trans "No partners configured" %}
            {% endif %}
        </p>
        <footer><a href="{% url 'admin_settings:partner_list' %}" role="button" class="outline">{% trans "Manage Partners" %}</a></footer>
    </article>
</div>
{% endblock %}

{% block extra_head %}
<style>
    .settings-indicator {
        font-size: 0.8125rem;
        color: var(--kn-text-secondary);
        margin-bottom: 0;
    }
</style>
{% endblock %}
