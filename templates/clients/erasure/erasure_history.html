{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "Erasure History" %}{% endblock %}

{% block content %}
<hgroup>
    <h1>{% trans "Erasure History" %}</h1>
    <p>{% trans "All erasure requests and their outcomes." %}</p>
</hgroup>

<nav aria-label="{% trans 'Erasure request views' %}" style="margin-bottom: 1rem;">
    <a href="{% url 'erasure_pending_list' %}" role="button" class="outline secondary">{% trans "Pending" %}</a>
    <a href="{% url 'erasure_history' %}" class="nav-active outline" role="button">{% trans "History" %}</a>
</nav>

{% if erasure_requests %}
<figure>
    <table role="grid">
        <thead>
            <tr>
                <th scope="col">{% trans "Code" %}</th>
                <th scope="col">{% trans "Record ID" %}</th>
                <th scope="col">{% trans "Level" %}</th>
                <th scope="col">{% trans "Requested By" %}</th>
                <th scope="col">{% trans "Date" %}</th>
                <th scope="col">{% trans "Status" %}</th>
                <th scope="col">{% trans "Completed" %}</th>
                <th scope="col"></th>
            </tr>
        </thead>
        <tbody>
            {% for er in erasure_requests %}
            <tr>
                <td>{{ er.erasure_code }}</td>
                <td>{{ er.client_record_id|default:"â€”" }}</td>
                <td><small>{{ er.get_erasure_tier_display }}</small></td>
                <td>{{ er.requested_by_display }}</td>
                <td>{{ er.requested_at|date:"Y-m-d" }}</td>
                <td>
                    {% if er.status == "pending" %}
                    <span class="badge badge-warning">{{ er.get_status_display }}</span>
                    {% elif er.status == "approved" or er.status == "anonymised" %}
                    <span class="badge badge-success">{{ er.get_status_display }}</span>
                    {% elif er.status == "rejected" %}
                    <span class="badge badge-danger">{{ er.get_status_display }}</span>
                    {% else %}
                    <span class="badge badge-secondary">{{ er.get_status_display }}</span>
                    {% endif %}
                </td>
                <td>{{ er.completed_at|date:"Y-m-d"|default:"â€”" }}</td>
                <td><a href="{% url 'erasure_request_detail' pk=er.pk %}">{% trans "View" %}</a></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</figure>
{% if page_obj.has_other_pages %}
<nav aria-label="{% trans 'Pagination' %}" style="margin-top: 1rem; text-align: center;">
    {% if page_obj.has_previous %}
    <a href="?page={{ page_obj.previous_page_number }}" role="button" class="outline secondary" style="font-size: 0.875rem;">{% trans "Previous" %}</a>
    {% endif %}
    <span style="margin: 0 0.5rem;">{% blocktrans with current=page_obj.number total=page_obj.paginator.num_pages %}Page {{ current }} of {{ total }}{% endblocktrans %}</span>
    {% if page_obj.has_next %}
    <a href="?page={{ page_obj.next_page_number }}" role="button" class="outline secondary" style="font-size: 0.875rem;">{% trans "Next" %}</a>
    {% endif %}
</nav>
{% endif %}

{% else %}
<div class="empty-state empty-state--erasure">
    <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="opacity: 0.45; margin-bottom: 0.5rem;"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><path d="m9 12 2 2 4-4"/></svg>
    <p>{% trans "No erasure requests have been made." %}</p>
</div>
{% endif %}
{% endblock %}
