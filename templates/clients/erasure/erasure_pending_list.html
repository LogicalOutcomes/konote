{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "Pending Erasure Requests" %}{% endblock %}

{% block content %}
<hgroup>
    <h1>{% trans "Pending Erasure Requests" %}</h1>
    <p>{% trans "Requests awaiting program manager approval." %}</p>
</hgroup>

<nav aria-label="{% trans 'Erasure request views' %}" style="margin-bottom: 1rem;">
    <a href="{% url 'erasure_pending_list' %}" class="nav-active outline" role="button">{% trans "Pending" %}</a>
    <a href="{% url 'erasure_history' %}" role="button" class="outline secondary">{% trans "History" %}</a>
</nav>

{% if pending_requests %}
<figure>
    <table role="grid">
        <thead>
            <tr>
                <th scope="col">{% trans "Code" %}</th>
                <th scope="col">{% trans "Record ID" %}</th>
                <th scope="col">{% trans "Level" %}</th>
                <th scope="col">{% trans "Requested By" %}</th>
                <th scope="col">{% trans "Date" %}</th>
                <th scope="col">{% trans "Approvals" %}</th>
                <th scope="col">{% trans "Age" %}</th>
                <th scope="col">{% trans "Status" %}</th>
                <th scope="col"></th>
            </tr>
        </thead>
        <tbody>
            {% for er in pending_requests %}
            <tr>
                <td>{{ er.erasure_code }}</td>
                <td>{{ er.client_record_id|default:"—" }}</td>
                <td><small>{{ er.get_erasure_tier_display }}</small></td>
                <td>{{ er.requested_by_display }}</td>
                <td>{{ er.requested_at|date:"Y-m-d" }}</td>
                <td>
                    {{ er.approvals.count }}/{{ er.programs_required|length }}
                    {% if er.is_stuck %}
                    <span class="badge badge-warning" title="{% trans 'This request may be stuck — a required program has no active PM.' %}">!</span>
                    {% endif %}
                </td>
                <td>
                    {% if er.days_pending >= 30 %}
                    <span class="badge badge-danger" title="{% trans 'PIPEDA requires a response within 30 days. This request is overdue.' %}">{{ er.days_pending }}d</span>
                    {% elif er.days_pending >= 25 %}
                    <span class="badge badge-warning" title="{% trans 'Approaching 30-day PIPEDA deadline.' %}">{{ er.days_pending }}d</span>
                    {% else %}
                    <span class="badge badge-secondary">{{ er.days_pending }}d</span>
                    {% endif %}
                </td>
                <td><span class="badge badge-warning">{% trans "Pending" %}</span></td>
                <td><a href="{% url 'erasure_request_detail' pk=er.pk %}">{% trans "Review" %}</a></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</figure>
{% else %}
<div class="empty-state empty-state--erasure">
    <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="opacity: 0.45; margin-bottom: 0.5rem;"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><path d="m9 12 2 2 4-4"/></svg>
    <p>{% trans "No pending erasure requests." %}</p>
</div>
{% endif %}
{% endblock %}
