{% extends "base.html" %}

{% block title %}{{ term.metric_plural|default:"Metrics" }} — {{ target.name }}{% endblock %}

{% block content %}
<hgroup>
    <h1>Assign {{ term.metric_plural|default:"Metrics" }}</h1>
    <p>{{ term.target|default:"Target" }}: {{ target.name }} — {{ client.first_name }} {{ client.last_name }}</p>
</hgroup>

<form method="post">
    {% csrf_token %}

    {% for category, metrics in metrics_by_category.items %}
    <fieldset>
        <legend>{{ category }}</legend>
        {% for metric in metrics %}
        <label>
            <input type="checkbox" name="metrics" value="{{ metric.pk }}"
                   {% if metric.pk in form.initial.metrics %}checked{% endif %}>
            <strong>{{ metric.name }}</strong>
            {% if metric.unit %}<small>({{ metric.unit }})</small>{% endif %}
            <br><small>{{ metric.definition|truncatewords:20 }}</small>
        </label>
        {% endfor %}
    </fieldset>
    {% empty %}
    <p>No enabled {{ term.metric_plural|default:"metrics" }} available. An administrator can add them in the <a href="{% url 'plans:metric_library' %}">metric library</a>.</p>
    {% endfor %}

    <div role="group">
        <button type="submit">Save {{ term.metric_plural|default:"Metrics" }}</button>
        <a href="{% url 'plans:plan_view' client_id=client.pk %}" role="button" class="outline secondary">Cancel</a>
    </div>
</form>
{% endblock %}
