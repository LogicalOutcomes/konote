{% extends "base.html" %}

{% block title %}History — {{ target.name }}{% endblock %}

{% block content %}
<hgroup>
    <h1>{{ term.target|default:"Target" }} History</h1>
    <p>{{ target.name }} — {{ client.first_name }} {{ client.last_name }}</p>
</hgroup>

<a href="{% url 'plans:plan_view' client_id=client.pk %}" role="button" class="outline secondary" style="margin-bottom: 1rem;">Back to {{ term.plan|default:"Plan" }}</a>

{% if revisions %}
<table role="grid" aria-label="Revision history">
    <thead>
        <tr>
            <th scope="col">Date</th>
            <th scope="col">Name</th>
            <th scope="col">Status</th>
            <th scope="col">Reason</th>
            <th scope="col">Changed by</th>
        </tr>
    </thead>
    <tbody>
        {% for rev in revisions %}
        <tr>
            <td>{{ rev.created_at|date:"Y-m-d H:i" }}</td>
            <td>{{ rev.name }}</td>
            <td>
                {% if rev.status == "default" %}
                    <span class="badge badge-success">Active</span>
                {% elif rev.status == "completed" %}
                    <span class="badge badge-info">Completed</span>
                {% else %}
                    <span class="badge badge-neutral">Deactivated</span>
                {% endif %}
            </td>
            <td>{{ rev.status_reason|default:"—" }}</td>
            <td>{% if rev.changed_by %}{{ rev.changed_by.display_name }}{% else %}—{% endif %}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<p><strong>Current values:</strong> {{ target.name }} — {{ target.get_status_display }}</p>
{% else %}
<p>No revision history for this {{ term.target|default:"target" }}.</p>
{% endif %}
{% endblock %}
