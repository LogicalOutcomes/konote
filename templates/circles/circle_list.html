{% extends "base.html" %}
{% load i18n %}

{% block title %}{{ term.circle_plural|default:"Circles" }} — {{ site.product_name|default:"KoNote" }}{% endblock %}

{% block content %}
<div class="page-header">
    <h1>{{ term.circle_plural|default:"Circles" }}</h1>
    <p>{% blocktrans with circles=term.circle_plural|default:"circles" %}All {{ circles }} you have access to.{% endblocktrans %}</p>
</div>

<div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; margin-bottom: 1rem;">
    {% if user_permissions.circle_create %}
    <a href="{% url 'circles:circle_create' %}" role="button">+ {% blocktrans with circle=term.circle|default:"Circle" %}New {{ circle }}{% endblocktrans %}</a>
    {% endif %}

    <form method="get" action="{% url 'circles:circle_list' %}" role="search" style="margin: 0;">
        <input type="search" name="q" value="{{ search_query }}" placeholder="{% trans 'Search by name...' %}" aria-label="{% blocktrans with circles=term.circle_plural|default:'circles' %}Search {{ circles }}{% endblocktrans %}" style="margin: 0;">
    </form>
</div>

{% if circles %}
<figure>
<table role="grid" aria-label="{% blocktrans with circles=term.circle_plural|default:'Circles' %}{{ circles }} list{% endblocktrans %}">
    <thead>
        <tr>
            <th scope="col">{% trans "Name" %}</th>
            <th scope="col">{% trans "Members" %}</th>
            <th scope="col">{% trans "Primary Contact" %}</th>
            <th scope="col">{% trans "Status" %}</th>
        </tr>
    </thead>
    <tbody>
        {% for item in circles %}
        <tr>
            <td>
                <a href="{% url 'circles:circle_detail' circle_id=item.circle.pk %}">{{ item.name }}</a>
            </td>
            <td data-label="{% trans 'Members' %}">{{ item.member_count }}</td>
            <td data-label="{% trans 'Primary Contact' %}">{{ item.primary_contact|default:"—" }}</td>
            <td data-label="{% trans 'Status' %}">
                {% if item.circle.status == "active" %}
                    <span class="badge badge-success">{% trans "Active" %}</span>
                {% else %}
                    <span class="badge badge-neutral">{% trans "Archived" %}</span>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
</figure>
{% else %}
<div class="empty-state">
    {% if search_query %}
        <p>{% blocktrans with circles=term.circle_plural|default:"circles" %}No {{ circles }} match your search.{% endblocktrans %}</p>
    {% else %}
        <p>{% blocktrans with circle=term.circle|default:"circle" %}No {{ circle }} records yet.{% endblocktrans %}</p>
        {% if user_permissions.circle_create %}
        <a href="{% url 'circles:circle_create' %}" role="button">{% trans "Create the first one" %}</a>
        {% endif %}
    {% endif %}
</div>
{% endif %}
{% endblock %}
